<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4Art Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†</title>
    <style>
        /* CSS Styles (All previous styles remain) */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: #1a1a2e;
            color: #e0e0e0;
            text-align: center;
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            transition: background-image 0.5s ease;
        }    
        header {
            background-color: rgba(0, 0, 0, 0.4);
            color: #fff;
            padding: 20px 25px;
            font-size: 30px;
            font-weight: bold;
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .container {
            max-width: 450px;
            margin: 40px auto;
            background: rgba(0, 0, 0, 0.5);
            padding: 30px 35px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            border-radius: 16px;
            font-size: 20px;
            line-height: 1.6;
        }

        input[type=text],
        input[type=email],
        input[type=tel],
        input[type=password],
        textarea,
        select {
            width: 100%;
            padding: 14px 12px;
            margin: 14px 0;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.4);
            color: #e0e0e0;
            border-radius: 8px;
            font-size: 18px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        input[type=text]:focus,
        input[type=email]:focus,
        input[type=tel]:focus,
        input[type=password]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #00bcd4;
        }

        button, .tab {
            background-color: #000000;
            color: white;
            border: 2px solid #00bcd4;
            padding: 12px 18px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            margin: 6px 0;
            transition: background-color 0.3s, transform 0.2s, color 0.3s;
        }

        button:hover, .tab:hover {
            background-color: #00bcd4;
            transform: translateY(-2px);
            color: #fff;
        }
        
        .productBtn {
            background-color: #000000;
            border: 2px solid #5a5a7e;
            margin-top: 18px;
            padding: 16px 20px;
            font-size: 20px;
            border-radius: 12px;
            font-weight: 700;
            width: 100%;
            display: inline-block;
            text-decoration: none;
            color: white;
            text-align: center;
        }
        .productBtn:hover {
            background-color: #5a5a7e;
            transform: translateY(-2px);
        }

        .backBtn {
            text-align: right;
            cursor: pointer;
            color: #888;
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 22px;
            transition: color 0.3s;
        }
        .backBtn:hover {
            color: #e0e0e0;
        }
        
        .error {
            color: #ff5252;
            font-size: 16px;
            margin-top: -6px;
            margin-bottom: 8px;
            text-align: right;
        }

        .section {
            display: none;
        }
        .active {
            display: block;
        }
        
        #ordersToggle, #messagesToggle, #adminToggle {
            position: fixed;
            top: 15px;
            right: 15px;
            font-size: 18px;
            color: white;
            background: #000000;
            border: 2px solid #00bcd4;
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
            display: none;
            z-index: 1200;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        #messagesToggle {
            right: 140px;
        }
        #adminToggle {
            top: 15px;
            left: 15px; /* ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡ Ù„ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„ÙŠØ³Ø§Ø± */
            background: #000000;
            border: 2px solid #ff8c00;
        }
        
        /* ØªÙ… Ø­Ø°Ù #adminLoginToggle Ù…Ù† CSS */

        .small {
            font-size: 14px;
            color: #aaa;
        }

        img.thumbnail {
            width: 100%;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
        }

        .thumb-inline {
            width: 100px;
            display: inline-block;
            margin: 6px;
            vertical-align: top;
            text-align: center;
        }

        .thumb-inline img {
            width: 100px;
            height: 70px;
            object-fit: cover;
            border-radius: 8px;
            display: block;
            margin-bottom: 6px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .eye {
            position: absolute;
            transform: translateX(-40px) translateY(10px);
            cursor: pointer;
            font-size: 18px;
            color: #00bcd4;
            user-select: none;
        }

        .relative {
            position: relative;
        }

        .admin-panel {
            text-align: right;
            direction: rtl;
        }

        hr {
            border: none;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin: 18px 0;
        }

        #imageDetail img {
            width: 100%;
            max-width: 420px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        #previewImg {
            max-width: 100%;
            border-radius: 8px;
            display: none;
            margin-top: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .order-item {
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            text-align: right;
            background: rgba(0, 0, 0, 0.4);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .order-actions button {
            margin-left: 8px;
            background-color: #000000;
            border: 2px solid #00bcd4;
        }
        
        .order-actions button:hover {
            background-color: #00bcd4;
        }

        .tabs {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 5px;
        }

        .tab {
            padding: 10px 14px;
            border-radius: 8px;
            background: #000000;
            border: 2px solid #5a5a7e;
            color: #fff;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
        }

        .tab.active {
            background: #00bcd4;
            border: 2px solid #00bcd4;
        }

        .delete-btn {
            background-color: #000000;
            border: 2px solid #ff5252;
            color: #ff5252;
        }

        .delete-btn:hover {
            background-color: #ff5252;
            color: #fff;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø´Ø§Øª */
        #myMessages, #adminChatWindow {
            background-image: none;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 0;
            border-radius: 16px;
        }

        #messagesContent, #adminMessagesContent {
            max-height: 400px;
            overflow-y: scroll;
            padding: 15px;
            border: none;
            border-radius: 0;
            background-color: transparent;
            margin-top: 15px;
        }

        .message {
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 15px;
            word-wrap: break-word;
            font-size: 16px;
            line-height: 1.4;
            max-width: 80%;
            position: relative;
        }
        .their-message {
            background-color: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            text-align: right;
            margin-right: 20%;
            border-radius: 15px 15px 0 15px;
            float: right;
            clear: both;
        }
        .my-message {
            background-color: #00bcd4;
            color: #fff;
            text-align: right;
            margin-left: 20%;
            border-radius: 15px 15px 15px 0;
            float: left;
            clear: both;
        }
        
        #messageInputContainer, #adminMessageInputContainer {
            display: flex;
            margin-top: 20px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.4);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0 0 16px 16px;
        }

        #messageInput, #adminMessageInput {
            flex-grow: 1;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.4);
            color: #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
        }

        #sendMessageBtn, #adminSendMessageBtn {
            margin-left: 8px;
            padding: 12px 18px;
            font-size: 18px;
            background-color: #000000;
            border: 2px solid #00bcd4;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Video background style */
        #backgroundVideo {
            position: fixed;
            top: 0;
            left: 0;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -100;
            background-size: cover;
            object-fit: cover;
        }

        /* Styles for Admin Client/Order Section */
        .client-item {
            border: 1px solid #00bcd4;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            text-align: right;
            background: rgba(0, 188, 212, 0.1);
            cursor: pointer;
            transition: background 0.3s;
        }
        .client-item:hover {
            background: rgba(0, 188, 212, 0.2);
        }

        .client-orders-list {
            margin-top: 15px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.4);
        }

        .client-order-item {
            border-bottom: 1px dashed rgba(255, 255, 255, 0.2);
            padding: 10px 0;
            margin-bottom: 5px;
        }
        .client-order-item:last-child {
            border-bottom: none;
        }
        
    </style>
    <div id="ordersToggle" title="Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª"> Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
    <div id="messagesToggle" title="Ø§Ù„Ø±Ø³Ø§Ø¦Ù„"> ØªÙˆØ§ØµÙ„</div>
    <div id="adminToggle" title="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…"> Ø§Ù„Ø£Ø¯Ù…Ù†</div>

    <section id="welcome" class="section active container">
        <header>Ø´Ø±ÙƒØ© ÙÙˆØ± Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†</header>
        <button class="productBtn" onclick="showSection('login')">Ø¯Ø®ÙˆÙ„</button>
    </section>

    <section id="login" class="section container">
        <div class="backBtn" onclick="showSection('welcome')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</header>
        <p class="small">Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¹Ù„Ø´Ø§Ù† ØªÙ‚Ø¯Ø± ØªØ±Ø³Ù„ Ø·Ù„Ø¨Ø§ØªÙƒ</p>

        <input type="tel" id="userPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†" />
        <div class="error" id="phoneError"></div>
        <input type="text" id="userName" placeholder="Ø§Ù„Ø§Ø³Ù…" />
        <div class="error" id="nameError"></div>
        <input type="email" id="userEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
        <div class="error" id="emailError"></div>
        <div class="error" id="loginError"></div>

        <button id="loginBtn" onclick="userLogin()">Ø¯Ø®ÙˆÙ„</button>
    </section>

    <section id="adminLoginChoice" class="section container">
        <div class="backBtn" onclick="showSection('welcome')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</header>
        <button class="productBtn" onclick="showSection('mainAdminLogin')">Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</button>
        <button class="productBtn" onclick="showSection('regularAdminLogin')">Ø£Ø¯Ù…Ù† Ø¹Ø§Ø¯ÙŠ</button>
    </section>

    <section id="mainAdminLogin" class="section container">
        <div class="backBtn" onclick="showSection('adminLoginChoice')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</header>
        <p class="small">Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ</p>
        
        <div id="otp-container">
            <input type="password" id="mainAdminOTP" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ" />
            <span class="eye" onclick="togglePasswordVisibility('mainAdminOTP')">ğŸ‘ï¸</span>
            <div class="error" id="mainAdminOTPError"></div>
            <button onclick="checkMainAdminLogin()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </section>

    <section id="regularAdminLogin" class="section container">
        <div class="backBtn" onclick="showSection('adminLoginChoice')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø¯Ø®ÙˆÙ„ Ø£Ø¯Ù…Ù† Ø¹Ø§Ø¯ÙŠ</header>
        <p class="small">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</p>
        <input type="text" id="regAdminUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" />
        <div class="relative">
            <input type="password" id="regAdminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" />
            <span class="eye" onclick="togglePasswordVisibility('regAdminPassword')">ğŸ‘ï¸</span>
        </div>
        <div class="error" id="regAdminLoginError"></div>
        <button onclick="checkRegularAdminLogin()">Ø¯Ø®ÙˆÙ„</button>
    </section>

    <section id="products" class="section container">
        <div class="backBtn" onclick="showSection('login')"> Ø±Ø¬ÙˆØ¹</div>
        <header>4Art</header>
        <div id="productButtonsContainer"></div>
    </section>

    <section id="subCategories" class="section container">
        <div class="backBtn" onclick="showSection('products')"> Ø±Ø¬ÙˆØ¹</div>
        <header id="subCategoriesHeader">Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ©</header>
        <div id="subCategoryButtonsContainer"></div>
    </section>

    <div id="dynamicSectionsContainer"></div>

    <section id="subCategoryImages" class="section container">
        <div class="backBtn" onclick="goBackToSubCategory()"> Ø±Ø¬ÙˆØ¹</div>
        <header id="subCategoryImagesHeader"></header>
        <div id="subCategoryImagesList"></div>
    </section>

    <section id="imageDetail" class="section container">
        <div class="backBtn" onclick="goBackToSubCategoryImages()"> Ø±Ø¬ÙˆØ¹</div>
        <header>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</header>
        <img id="detailImg" src="" style="width:100%;border-radius:8px;" />
        <div style="margin-top:12px;">
            <button id="detailOrderBtn" class="productBtn">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
            <button id="inquiryHereBtn" class="productBtn" style="background-color:#000000; border:2px solid #5a5a7e; margin-top:12px;">Ø§Ø³ØªÙØ³Ø§Ø± Ù‡Ù†Ø§</button>
        </div>
    </section>

    <section id="adminPage" class="section container">
        <div class="backBtn" onclick="adminLogout()"> Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù†</div>
        <header>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</header>
        <div id="adminPageButtons"></div>
    </section>

    <section id="adminManageAdminsSection" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminPage')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</header>
        <h3>Ø¥Ø¶Ø§ÙØ© Ø£Ø¯Ù…Ù† Ø¬Ø¯ÙŠØ¯</h3>
        <input type="text" id="newAdminUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" />
        <div class="relative">
            <input type="password" id="newAdminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" />
            <span class="eye" onclick="togglePasswordVisibility('newAdminPassword')">ğŸ‘ï¸</span>
        </div>
        <button onclick="addRegularAdmin()">Ø¥Ø¶Ø§ÙØ© Ø£Ø¯Ù…Ù†</button>
        <hr>
        <h4>Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø­Ø§Ù„ÙŠÙˆÙ†</h4>
        <ul id="adminsList"></ul>
    </section>

    <section id="adminPermissionsSection" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminPage')"> Ø±Ø¬ÙˆØ¹</div>
        <header>ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù†</header>
        <p class="small">Ø­Ø¯Ø¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„ÙƒÙ„ Ø£Ø¯Ù…Ù† Ø¹Ø§Ø¯ÙŠ</p>
        <div id="adminPermissionsList"></div>
    </section>

    <section id="adminOrdersSection" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminPage')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</header>
        <div id="adminOrdersList"></div>
    </section>

    <section id="adminPendingOrdersSection" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminPage')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù„Ù‘ÙÙ‚Ø© (Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°)</header>
        <div id="adminPendingOrdersList"></div>
    </section>

    <section id="adminCompletedOrdersSection" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminPage')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</header>
        <div id="adminCompletedOrdersList"></div>
    </section>

    <section id="adminMessagesSection" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminPage')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</header>
        <div id="chatUsersList"></div>
    </section>
    
    <section id="adminClientOrdersSection" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminPage')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª</header>
        
        <h3>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„</h3>
        <p class="small">Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†ØŒ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Phone ID)</p>
        <input type="text" id="clientSearchInput" placeholder="Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… ØªÙ„ÙŠÙÙˆÙ† Ø£Ùˆ ID" onkeyup="filterClients()" />
        
        <hr>
        
        <div id="adminClientsListArea">
            <h4 style="text-align: right;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h4>
            <div id="filteredClientsList">
                </div>
        </div>

        <div id="clientOrdersDetailArea" style="display:none; text-align:right;">
            <hr>
            <h4 id="clientOrdersHeader">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„: [Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„]</h4>
            
            <p class="small">Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ (Order ID)</p>
            <input type="text" id="orderSearchInput" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨" onkeyup="filterClientOrders()" />
            
            <div id="currentClientOrdersList" class="client-orders-list">
                </div>
        </div>

    </section>

    <section id="adminClientsSection" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminPage')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</header>
        <ul id="clientList" style="text-align:right;"></ul>
    </section>

    <section id="adminMainSectionsSection" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminPage')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</header>
        <h3>Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠ Ø¬Ø¯ÙŠØ¯</h3>
        <input type="text" id="newSectionName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ù…Ø«Ø§Ù„: Ø¯Ø±ÙˆØ¹ØŒ Ù…ÙŠØ¯Ø§Ù„ÙŠØ§Øª)" />
        <button onclick="addMainSection()">Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠ</button>
        <h4>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
        <ul id="mainSectionsList"></ul>
    </section>

    <section id="adminSubSectionsSection" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminPage')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ©</header>
        <label class="small">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ ØªØ­ØªÙ‡</label>
        <select id="mainSectionSelect"></select>
        <h3>Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ Ø¬Ø¯ÙŠØ¯</h3>
        <input type="text" id="newSubSectionName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ (Ù…Ø«Ø§Ù„: Ø¯Ø±ÙˆØ¹ Ø®Ø´Ø¨ØŒ Ø¯Ø±ÙˆØ¹ ÙƒØ±ÙŠØ³ØªØ§Ù„)" />
        <button onclick="addSubSection()">Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ</button>
        <hr>
        <h4>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
        <div id="subSectionsList"></div>
    </section>


    <section id="adminImagesSection" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminPage')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø¥Ø¯Ø§Ø±Ø© ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</header>
        
        <label class="small">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
        <select id="imageMainCategory" onchange="populateSubCategorySelect()">
            <option value="">Ø§Ø®ØªØ± Ù‚Ø³Ù…Ø§Ù‹ Ø±Ø¦ÙŠØ³ÙŠØ§Ù‹</option>
        </select>
        
        <label class="small">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ</label>
        <select id="imageSubCategory">
            <option value="">Ø§Ø®ØªØ± Ù‚Ø³Ù…Ø§Ù‹ ÙØ±Ø¹ÙŠØ§Ù‹</option>
        </select>
        
        <p class="small">ØªÙ‚Ø¯Ø± ØªØ¶ÙŠÙ ØµÙˆØ±Ø© Ø¨ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø§Ù„Ø·Ø±ÙŠÙ‚ØªÙŠÙ†: Ø±ÙØ¹ Ù…Ù„Ù Ø£Ùˆ Ø±Ø§Ø¨Ø· Ù„Ù„ØµÙˆØ±Ø©</p>
        <input type="file" id="productImageFile" accept="image/*" />
        <input type="text" id="productImageUrl" placeholder="Ø£Ùˆ Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§" />
        <button onclick="addImage()">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
        <h4>Ø§Ù„ØµÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
        <div id="imageList" style="text-align:right;"></div>
    </section>

    <section id="adminBackgroundsSection" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminPage')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ§Øª</header>

        <label class="small">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ù‡</label>
        <select id="backgroundTarget" onchange="loadCurrentBackground()">
            <option value="global_image">Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© (ØµÙˆØ±Ø©)</option>
            <option value="global_video">Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© (ÙÙŠØ¯ÙŠÙˆ)</option>
            <option value="welcome">Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨</option>
            <option value="login">ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</option>
            <option value="products">ØµÙØ­Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
            <option value="myOrders">ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</option>
            <option value="myMessages">ØµÙØ­Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</option>
            <option value="adminPage">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</option>
            <option value="adminOrdersSection">ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</option>
            <option value="adminPendingOrdersSection">ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‘ÙÙ‚Ø©</option>
            <option value="adminCompletedOrdersSection">ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</option>
            <option value="adminMessagesSection">ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</option>
            <option value="adminClientOrdersSection">ØµÙØ­Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª</option>
            <option value="adminClientsSection">ØµÙØ­Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</option>
            <option value="adminMainSectionsSection">ØµÙØ­Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</option>
            <option value="adminSubSectionsSection">ØµÙØ­Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ©</option>
            <option value="adminImagesSection">ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ±</option>
            <option value="adminBackgroundsSection">ØµÙØ­Ø© Ø§Ù„Ø®Ù„ÙÙŠØ§Øª</option>
        </select>

        <hr>
        
        <div id="imageControls">
            <h3>ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©</h3>
            <p class="small">Ù‚Ù… Ø¨Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ù„Ù‡Ø§.</p>
            <input type="file" id="bgImageFile" accept="image/*" />
            <input type="text" id="bgImageUrl" placeholder="Ø£Ùˆ Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§" />
            <button onclick="setSpecificBackground('image')">ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© (ØµÙˆØ±Ø©)</button>
        </div>
        
        <div id="videoControls">
            <h3>ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ù„ÙÙŠØ©</h3>
            <p class="small">Ø¶Ø¹ Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ (MP4) Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø®Ø§Ø±Ø¬ÙŠ.</p>
            <input type="text" id="bgVideoUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (mp4)" />
            <button onclick="setSpecificBackground('video')">ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© (ÙÙŠØ¯ÙŠÙˆ)</button>
        </div>
    </section>

    <section id="myOrders" class="section container">
        <div class="backBtn" onclick="showSection('products')"> Ø±Ø¬ÙˆØ¹</div>
        <header>Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</header>
        <p id="clientOrderIDDisplay" class="small" style="text-align: right; color: #00bcd4; font-size: 18px; margin-top: -10px;"></p>

        <div class="tabs">
            <div id="tabPending" class="tab active" onclick="switchOrdersTab('pending')">Ù…Ø¹Ù„Ù‘ÙÙ‚</div>
            <div id="tabCompleted" class="tab" onclick="switchOrdersTab('completed')">Ù…ÙƒØªÙ…Ù„Ø©</div>
            <div id="tabCancelled" class="tab" onclick="switchOrdersTab('cancelled')">Ù…Ù„ØºÙŠØ©</div>
        </div>

        <div id="ordersContent" style="margin-top:12px; text-align:right;"></div>
    </section>

    <section id="myMessages" class="section container">
        <div class="backBtn" onclick="showSection('products')"> Ø±Ø¬ÙˆØ¹</div>
        <header>ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</header>

        <div class="tabs">
            <div id="tabInquiry" class="tab active" onclick="switchChatTab('inquiry')">Ø§Ø³ØªÙØ³Ø§Ø±</div>
            <div id="tabComplaint" class="tab" onclick="switchChatTab('complaint')">Ø´ÙƒÙˆÙ‰</div>
        </div>

        <div id="messagesContent"></div>
        <div id="messageInputContainer">
            <input type="text" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." />
            <button id="sendMessageBtn">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </section>

    <section id="adminChatWindow" class="section container">
        <div class="backBtn" onclick="showAdminSection('adminMessagesSection')"> Ø±Ø¬ÙˆØ¹</div>
        <header id="adminChatHeader">
            <button id="adminClientDataBtn" style="font-size:14px; padding:6px 10px;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
        </header>
        <div class="tabs">
            <div id="adminTabInquiry" class="tab active" onclick="switchAdminChatTab('inquiry')">Ø§Ø³ØªÙØ³Ø§Ø±</div>
            <div id="adminTabComplaint" class="tab" onclick="switchAdminChatTab('complaint')">Ø´ÙƒÙˆÙ‰</div>
        </div>
        <div id="adminMessagesContent"></div>
        <div id="adminMessageInputContainer">
            <input type="text" id="adminMessageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." />
            <button id="adminSendMessageBtn">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </section>

    <video id="backgroundVideo" autoplay loop muted playsinline></video>

    <script>
        /* ======= Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ======= */
        const STORAGE_KEYS = {
            SECTIONS: '4art_sections_v4', 
            IMAGES: '4art_images_v4',     
            ORDERS: '4art_orders_v4',
            CLIENTS: '4art_clients_v3',
            CHATS: '4art_chats_v3',
            ADMINS: '4art_admins_v3',
            BACKGROUNDS: '4art_backgrounds_v4'
        };
        
        // ** Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ **: Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        const mainAdminCredentials = {
            phone: "01210511112",
            name: "george",
            password: "##S$5&90" // ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        };
        
        const adminPages = [
            { id: 'adminOrdersSection', name: 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©' },
            { id: 'adminPendingOrdersSection', name: 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‘ÙÙ‚Ø©' }, 
            { id: 'adminCompletedOrdersSection', name: 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©' }, 
            { id: 'adminMessagesSection', name: 'Ø§Ù„Ø±Ø³Ø§Ø¦Ù„' },
            { id: 'adminClientOrdersSection', name: 'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª' }, 
            { id: 'adminClientsSection', name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡' },
            { id: 'adminMainSectionsSection', name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' },
            { id: 'adminSubSectionsSection', name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ©' },     
            { id: 'adminImagesSection', name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ±' },
            // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± Ù„Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙÙ‚Ø·
            { id: 'adminManageAdminsSection', name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯Ù…Ù†', mainOnly: true },
            { id: 'adminPermissionsSection', name: 'ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù†', mainOnly: true },
            { id: 'adminBackgroundsSection', name: 'Ø§Ù„Ø®Ù„ÙÙŠØ§Øª', mainOnly: true }
        ];

        let sections = JSON.parse(localStorage.getItem(STORAGE_KEYS.SECTIONS)) || {
            'talabat_ukhra': { id: 'talabat_ukhra', name: 'Ø·Ù„Ø¨Ø§Øª Ø£Ø®Ø±Ù‰', subsections: {
                'general_orders': { id: 'general_orders', name: 'Ø·Ù„Ø¨Ø§Øª Ø¹Ø§Ù…Ø©' }
            }}
        };
        
        let images = JSON.parse(localStorage.getItem(STORAGE_KEYS.IMAGES)) || { 'general_orders': [] };
        let orders = JSON.parse(localStorage.getItem(STORAGE_KEYS.ORDERS)) || [];
        let clients = JSON.parse(localStorage.getItem(STORAGE_KEYS.CLIENTS)) || [];
        let admins = JSON.parse(localStorage.getItem(STORAGE_KEYS.ADMINS)) || [];
        let chats = JSON.parse(localStorage.getItem(STORAGE_KEYS.CHATS)) || {};
        
        let backgrounds = JSON.parse(localStorage.getItem(STORAGE_KEYS.BACKGROUNDS)) || {
            global_image: null, global_video: null, welcome: null, login: null, products: null, myOrders: null, myMessages: null, adminPage: null,
            adminOrdersSection: null, adminPendingOrdersSection: null, adminCompletedOrdersSection: null,
            adminMessagesSection: null, adminClientsSection: null, adminMainSectionsSection: null,
            adminSubSectionsSection: null, adminImagesSection: null, adminBackgroundsSection: null,
            adminClientOrdersSection: null
        };

        let currentUser = null;
        let loggedInAdmin = null;
        let currentMainCategory = ''; 
        let currentSubCategory = '';  
        let lastCategoryBeforeDetail = 'products';
        let activeChatId = null;
        let activeClientChatType = 'inquiry';
        let activeAdminChatType = 'inquiry';
        let currentActiveSection = 'welcome';
        let currentClientForOrders = null; 

        window.onload = function() {
            renderProductButtons();
            showSection('welcome'); 
        };

        function togglePasswordVisibility(id) {
            const input = document.getElementById(id);
            input.type = input.type === "password" ? "text" : "password";
        }
        
        function generateId(name) {
            return name.toLowerCase().replace(/[^a-z0-9]/g, '_').substring(0, 20) + '_' + Date.now().toString().slice(-4);
        }

        function saveClients() { localStorage.setItem(STORAGE_KEYS.CLIENTS, JSON.stringify(clients)); }
        function saveChats() { localStorage.setItem(STORAGE_KEYS.CHATS, JSON.stringify(chats)); }
        function saveOrders() { localStorage.setItem(STORAGE_KEYS.ORDERS, JSON.stringify(orders)); }
        function saveSections() { localStorage.setItem(STORAGE_KEYS.SECTIONS, JSON.stringify(sections)); }
        function saveImages() { localStorage.setItem(STORAGE_KEYS.IMAGES, JSON.stringify(images)); }
        function saveAdmins() { localStorage.setItem(STORAGE_KEYS.ADMINS, JSON.stringify(admins)); }
        function saveBackgrounds() { localStorage.setItem(STORAGE_KEYS.BACKGROUNDS, JSON.stringify(backgrounds)); }


        /* ======= ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„Ø¹Ø±Ø¶ ======= */
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            const el = document.getElementById(id);
            if (el) el.classList.add('active');

            currentActiveSection = id; 
            applyBackground(id); 
            updateNavButtons();
        }

        function showAdminSection(id) {
            if (!loggedInAdmin) return showSection('adminLoginChoice');
            
            // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
            const pageInfo = adminPages.find(p => p.id === id);
            if (pageInfo && !loggedInAdmin.isMain && !loggedInAdmin.permissions.includes(id) && !pageInfo.mainOnly) {
                 alert('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù….');
                 return;
            }
            if (pageInfo && pageInfo.mainOnly && !loggedInAdmin.isMain) {
                 alert('Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù…Ø®ØµØµ Ù„Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙÙ‚Ø·.');
                 return;
            }
            
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            const el = document.getElementById(id);
            if (el) el.classList.add('active');
            
            currentActiveSection = id; 
            applyBackground(id);

            if (id === 'adminOrdersSection') renderAdminOrdersList();
            if (id === 'adminPendingOrdersSection') renderAdminPendingOrdersList();
            if (id === 'adminCompletedOrdersSection') renderAdminCompletedOrdersList();
            if (id === 'adminMessagesSection') renderAdminChatList();
            if (id === 'adminClientOrdersSection') initAdminClientOrders(); 
            if (id === 'adminClientsSection') loadClients();
            if (id === 'adminMainSectionsSection') loadMainSectionsList();
            if (id === 'adminSubSectionsSection') loadSubSectionsAdmin();
            if (id === 'adminImagesSection') {
                populateImageCategorySelects();
                loadImagesList();
            }
            if (id === 'adminManageAdminsSection' && loggedInAdmin.isMain) loadAdminsList();
            if (id === 'adminPermissionsSection' && loggedInAdmin.isMain) loadAdminPermissions();
            if (id === 'adminBackgroundsSection' && loggedInAdmin.isMain) loadBackgroundTargetOptions();
        }

        function updateNavButtons() {
            // ** ØªÙ… Ø­Ø°Ù adminLoginToggle **
            const ordersToggle = document.getElementById('ordersToggle');
            const messagesToggle = document.getElementById('messagesToggle');
            const adminToggle = document.getElementById('adminToggle');
        
            if (currentUser) {
                ordersToggle.style.display = 'block';
                messagesToggle.style.display = 'block';
                adminToggle.style.display = 'none';
            } else if (loggedInAdmin) {
                ordersToggle.style.display = 'none';
                messagesToggle.style.display = 'none';
                adminToggle.style.display = 'block';
            } else {
                // Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù† Ø£Ùˆ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ Ù†Ø±Ø¬Ø¹ Ù„Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
                ordersToggle.style.display = 'none';
                messagesToggle.style.display = 'none';
                adminToggle.style.display = 'none';
            }
        }

        function adminLogout() {
            loggedInAdmin = null;
            currentUser = null;
            showSection('welcome');
        }

        function checkPermissions(pageId) {
            if (!loggedInAdmin) return false;
            if (loggedInAdmin.isMain) return true;
            return loggedInAdmin.permissions.includes(pageId);
        }

        // Event Listeners for Nav buttons
        document.getElementById('ordersToggle').addEventListener('click', () => { 
            if (currentUser) {
                showSection('myOrders'); 
                document.getElementById('clientOrderIDDisplay').textContent = `Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (ID): ${currentUser.phone}`;
                switchOrdersTab('pending'); 
            }
        });
        document.getElementById('messagesToggle').addEventListener('click', () => { 
            if (currentUser) { showSection('myMessages'); switchChatTab('inquiry'); } 
            else if (loggedInAdmin) { showAdminSection('adminMessagesSection'); } 
            else { alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø©.'); showSection('login'); }
        });
        document.getElementById('adminToggle').addEventListener('click', () => {
            if (loggedInAdmin) {
                showSection('adminPage');
                const adminPageButtons = document.getElementById('adminPageButtons');
                adminPageButtons.innerHTML = '';
                
                // Ø¯Ù…Ø¬ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙˆØ§Ù„Ø¹Ø§Ø¯ÙŠ
                adminPages.forEach(page => {
                    if (page.mainOnly && !loggedInAdmin.isMain) return; // ØªØ®Ø·ÙŠ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø£Ø¯Ù…Ù† Ø±Ø¦ÙŠØ³ÙŠ
                    if (!page.mainOnly && !loggedInAdmin.isMain && !loggedInAdmin.permissions.includes(page.id)) return; // ØªØ®Ø·ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù„Ø¯ÙŠÙ‡ ØµÙ„Ø§Ø­ÙŠØ©
                    
                    const btn = document.createElement('button');
                    btn.className = 'productBtn';
                    btn.textContent = page.name;
                    btn.onclick = () => showAdminSection(page.id);
                    adminPageButtons.appendChild(btn);
                });
            }
        });

        /* ======= ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ / Ø§Ù„Ø£Ø¯Ù…Ù† ======= */
        function validateUserInputs() {
            const phone = document.getElementById('userPhone').value.trim();
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            document.getElementById('phoneError').textContent = '';
            document.getElementById('nameError').textContent = '';
            document.getElementById('emailError').textContent = '';
            document.getElementById('loginError').textContent = '';
            
            let valid = true;
            if (!/^\d{11}$/.test(phone)) { document.getElementById('phoneError').textContent = 'Ø±Ù‚Ù… ØªÙ„ÙŠÙÙˆÙ† ØºÙŠØ± ØµØ­ÙŠØ­ (11 Ø±Ù‚Ù…)'; valid = false; }
            if (name.length < 2) { document.getElementById('nameError').textContent = 'Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… ØµØ­ÙŠØ­'; valid = false; }
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { document.getElementById('emailError').textContent = 'Ø§ÙŠÙ…ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­'; valid = false; }
            
            return valid;
        }

        function userLogin() {
            const phone = document.getElementById('userPhone').value.trim();
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            
            if (!validateUserInputs()) {
                document.getElementById('loginError').textContent = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©.';
                return;
            }
            
            // ** Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ **: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
            if (phone === mainAdminCredentials.phone && name.toLowerCase() === mainAdminCredentials.name.toLowerCase()) {
                document.getElementById('loginError').textContent = '';
                showSection('adminLoginChoice'); 
                return;
            }

            // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
            currentUser = { phone, name, email };
            const existingClient = clients.find(c => c.phone === currentUser.phone);
            if (!existingClient) {
                clients.push(currentUser);
                saveClients();
            }
            
            if (!chats[currentUser.phone]) {
                chats[currentUser.phone] = {
                    clientName: currentUser.name,
                    clientId: currentUser.phone,
                    chats: { inquiry: [], complaint: [] },
                    newMessages: { inquiry: false, complaint: false }
                };
                saveChats();
            }

            showSection('products');
            renderProductButtons();
        }
        
        function checkMainAdminLogin() {
            const otp = document.getElementById('mainAdminOTP').value.trim();
            document.getElementById('mainAdminOTPError').textContent = '';
            
            // ** Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ **: Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            if (otp === mainAdminCredentials.password) {
                loggedInAdmin = { isMain: true, username: 'main-admin', permissions: adminPages.map(p => p.id) };
                showSection('adminPage');
                document.getElementById('adminToggle').click(); 
            } else {
                document.getElementById('mainAdminOTPError').textContent = 'Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­.';
            }
        }

        function checkRegularAdminLogin() {
            const username = document.getElementById('regAdminUsername').value.trim();
            const password = document.getElementById('regAdminPassword').value.trim();
            document.getElementById('regAdminLoginError').textContent = '';
            
            const admin = admins.find(a => a.username === username && a.password === password);
            
            if (admin) {
                loggedInAdmin = admin;
                showSection('adminPage');
                document.getElementById('adminToggle').click(); 
            } else {
                document.getElementById('regAdminLoginError').textContent = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.';
            }
        }

        /* ======= Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯Ù…Ù† ÙˆØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡Ù… (Ù„Ù… ØªØªØºÙŠØ±) ======= */
        function addRegularAdmin() {
            const username = document.getElementById('newAdminUsername').value.trim();
            const password = document.getElementById('newAdminPassword').value.trim();
            if (username && password) {
                if (admins.some(a => a.username === username)) {
                    alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„.');
                    return;
                }
                admins.push({ username, password, isMain: false, permissions: [] });
                saveAdmins();
                document.getElementById('newAdminUsername').value = '';
                document.getElementById('newAdminPassword').value = '';
                loadAdminsList();
                loadAdminPermissions();
                alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¯Ù…Ù† Ø¨Ù†Ø¬Ø§Ø­.');
            } else {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±.');
            }
        }

        function loadAdminsList() {
            const list = document.getElementById('adminsList');
            list.innerHTML = '';
            admins.filter(a => !a.isMain).forEach(admin => {
                const li = document.createElement('li');
                li.innerHTML = `
                    ${admin.username} 
                    <button class="delete-btn" style="margin-right: 10px;" onclick="deleteAdmin('${admin.username}')">Ø­Ø°Ù</button>
                `;
                list.appendChild(li);
            });
            if (admins.filter(a => !a.isMain).length === 0) {
                list.innerHTML = '<p class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¯Ù…Ù† Ø¹Ø§Ø¯ÙŠ Ù…Ø³Ø¬Ù„.</p>';
            }
        }

        function deleteAdmin(username) {
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø£Ø¯Ù…Ù† ${username}ØŸ`)) {
                admins = admins.filter(a => a.username !== username);
                saveAdmins();
                loadAdminsList();
                loadAdminPermissions();
            }
        }

        function loadAdminPermissions() {
            const list = document.getElementById('adminPermissionsList');
            list.innerHTML = '';

            admins.filter(a => !a.isMain).forEach(admin => {
                const div = document.createElement('div');
                div.className = 'admin-panel';
                div.innerHTML = `<h4>ØµÙ„Ø§Ø­ÙŠØ§Øª: ${admin.username}</h4>`;
                
                adminPages.filter(p => !p.mainOnly).forEach(page => { // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªÙŠ Ù„ÙŠØ³Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙÙ‚Ø·
                    const checked = admin.permissions.includes(page.id) ? 'checked' : '';
                    div.innerHTML += `
                        <label style="display: block; margin-right: 15px;">
                            <input type="checkbox" ${checked} onchange="updateAdminPermission('${admin.username}', '${page.id}', this.checked)">
                            ${page.name}
                        </label>
                    `;
                });
                list.appendChild(div);
                list.appendChild(document.createElement('hr'));
            });

            if (admins.filter(a => !a.isMain).length === 0) {
                list.innerHTML = '<p class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¯Ù…Ù† Ø¹Ø§Ø¯ÙŠ Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ù‡.</p>';
            }
        }

        function updateAdminPermission(username, pageId, isChecked) {
            const admin = admins.find(a => a.username === username);
            if (admin) {
                if (isChecked) {
                    if (!admin.permissions.includes(pageId)) admin.permissions.push(pageId);
                } else {
                    admin.permissions = admin.permissions.filter(id => id !== pageId);
                }
                saveAdmins();
            }
        }

        /* ======= Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Main & Sub) (Ù„Ù… ØªØªØºÙŠØ±) ======= */
        function addMainSection() {
            const name = document.getElementById('newSectionName').value.trim();
            if (name) {
                const id = generateId(name);
                sections[id] = { id, name, subsections: {} };
                saveSections();
                document.getElementById('newSectionName').value = '';
                loadMainSectionsList();
                renderProductButtons();
                populateImageCategorySelects();
                alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.');
            }
        }

        function loadMainSectionsList() {
            const list = document.getElementById('mainSectionsList');
            list.innerHTML = '';
            Object.values(sections).forEach(section => {
                const li = document.createElement('li');
                li.innerHTML = `
                    ${section.name} (ID: ${section.id})
                    <button class="delete-btn" style="margin-right: 10px;" onclick="deleteMainSection('${section.id}')">Ø­Ø°Ù</button>
                `;
                list.appendChild(li);
            });
        }

        function deleteMainSection(sectionId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ© ÙˆØ§Ù„ØµÙˆØ± Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù‡.')) {
                Object.keys(sections[sectionId].subsections).forEach(subId => {
                    delete images[subId];
                });
                delete sections[sectionId];
                saveSections();
                saveImages();
                loadMainSectionsList();
                loadSubSectionsAdmin();
                renderProductButtons();
                populateImageCategorySelects();
            }
        }

        function addSubSection() {
            const mainId = document.getElementById('mainSectionSelect').value;
            const subName = document.getElementById('newSubSectionName').value.trim();
            if (mainId && subName) {
                const subId = generateId(subName);
                sections[mainId].subsections[subId] = { id: subId, name: subName };
                images[subId] = []; 
                saveSections();
                saveImages();
                document.getElementById('newSubSectionName').value = '';
                loadSubSectionsAdmin();
                populateImageCategorySelects();
                alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ.');
            } else {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠ ÙˆØ¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ.');
            }
        }

        function loadSubSectionsAdmin() {
            const mainSelect = document.getElementById('mainSectionSelect');
            const listDiv = document.getElementById('subSectionsList');
            mainSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù‚Ø³Ù…Ø§Ù‹ Ø±Ø¦ÙŠØ³ÙŠØ§Ù‹</option>';
            listDiv.innerHTML = '';

            Object.values(sections).forEach(mainSection => {
                const mainOption = document.createElement('option');
                mainOption.value = mainSection.id;
                mainOption.textContent = mainSection.name;
                mainSelect.appendChild(mainOption);

                const ul = document.createElement('ul');
                ul.style.textAlign = 'right';
                ul.innerHTML = `<h4>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ© ÙÙŠ "${mainSection.name}"</h4>`;
                
                Object.values(mainSection.subsections).forEach(subSection => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        ${subSection.name} (ID: ${subSection.id})
                        <button class="delete-btn" style="margin-right: 10px;" onclick="deleteSubSection('${mainSection.id}', '${subSection.id}')">Ø­Ø°Ù</button>
                    `;
                    ul.appendChild(li);
                });
                listDiv.appendChild(ul);
                listDiv.appendChild(document.createElement('hr'));
            });
        }

        function deleteSubSection(mainId, subId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù‡.')) {
                delete sections[mainId].subsections[subId];
                delete images[subId];
                saveSections();
                saveImages();
                loadSubSectionsAdmin();
                populateImageCategorySelects();
                renderProductButtons();
            }
        }

        /* ======= ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ù„Ù… ØªØªØºÙŠØ±) ======= */
        function renderProductButtons() {
            const container = document.getElementById('productButtonsContainer');
            if (!container) return;
            container.innerHTML = '';
            Object.values(sections).forEach(section => {
                const btn = document.createElement('button');
                btn.className = 'productBtn';
                btn.textContent = section.name;
                btn.onclick = () => showSubCategories(section.id);
                container.appendChild(btn);
            });
        }

        function showSubCategories(mainId) {
            currentMainCategory = mainId;
            const mainSection = sections[mainId];
            document.getElementById('subCategoriesHeader').textContent = mainSection.name;
            const container = document.getElementById('subCategoryButtonsContainer');
            container.innerHTML = '';
            
            Object.values(mainSection.subsections).forEach(sub => {
                const btn = document.createElement('button');
                btn.className = 'productBtn';
                btn.textContent = sub.name;
                btn.onclick = () => showSubCategoryImages(sub.id);
                container.appendChild(btn);
            });
            showSection('subCategories');
        }

        function showSubCategoryImages(subId) {
            currentSubCategory = subId;
            lastCategoryBeforeDetail = 'subCategoryImages';
            
            let subName = '';
            let mainName = '';
            for (const mainKey in sections) {
                if (sections[mainKey].subsections[subId]) {
                    subName = sections[mainKey].subsections[subId].name;
                    mainName = sections[mainKey].name;
                    break;
                }
            }

            document.getElementById('subCategoryImagesHeader').textContent = `${mainName} / ${subName}`;
            const listDiv = document.getElementById('subCategoryImagesList');
            listDiv.innerHTML = '';
            
            const subImages = images[subId] || [];
            if (subImages.length === 0) {
                listDiv.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
            } else {
                subImages.forEach(img => {
                    const div = document.createElement('div');
                    div.className = 'thumb-inline';
                    div.onclick = () => showImageDetail(img);
                    div.innerHTML = `<img src="${img.url}" alt="ØµÙˆØ±Ø© Ù…Ù†ØªØ¬" />`;
                    listDiv.appendChild(div);
                });
            }
            showSection('subCategoryImages');
        }

        function goBackToSubCategory() {
            showSubCategories(currentMainCategory);
        }

        function showImageDetail(img) {
            const detailImg = document.getElementById('detailImg');
            detailImg.src = img.url;
            
            document.getElementById('detailOrderBtn').onclick = () => createOrder(img.url);
            document.getElementById('inquiryHereBtn').onclick = () => startInquiry(img.url);
            
            showSection('imageDetail');
        }
        
        function goBackToSubCategoryImages() {
            showSubCategoryImages(currentSubCategory);
        }

        /* ======= Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø§Ù„ØµÙˆØ±) (Ù„Ù… ØªØªØºÙŠØ±) ======= */
        function populateImageCategorySelects() {
            const mainSelect = document.getElementById('imageMainCategory');
            const subSelect = document.getElementById('imageSubCategory');
            
            const currentMain = mainSelect.value;
            
            mainSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù‚Ø³Ù…Ø§Ù‹ Ø±Ø¦ÙŠØ³ÙŠØ§Ù‹</option>';
            Object.values(sections).forEach(section => {
                const option = document.createElement('option');
                option.value = section.id;
                option.textContent = section.name;
                mainSelect.appendChild(option);
            });

            mainSelect.value = currentMain;
            populateSubCategorySelect();
        }

        function populateSubCategorySelect() {
            const mainId = document.getElementById('imageMainCategory').value;
            const subSelect = document.getElementById('imageSubCategory');
            subSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù‚Ø³Ù…Ø§Ù‹ ÙØ±Ø¹ÙŠØ§Ù‹</option>';
            
            if (mainId && sections[mainId]) {
                Object.values(sections[mainId].subsections).forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub.id;
                    option.textContent = sub.name;
                    subSelect.appendChild(option);
                });
            }
        }

        function fileToUrl(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        async function addImage() {
            const subId = document.getElementById('imageSubCategory').value;
            const fileInput = document.getElementById('productImageFile');
            const urlInput = document.getElementById('productImageUrl');
            let imageUrl = urlInput.value.trim();

            if (!subId) { alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ.'); return; }

            if (fileInput.files.length > 0) {
                try {
                    imageUrl = await fileToUrl(fileInput.files[0]);
                } catch (error) {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø©.');
                    return;
                }
            }
            
            if (imageUrl) {
                if (!images[subId]) { images[subId] = []; }
                images[subId].push({ url: imageUrl, id: generateId('img') });
                saveImages();
                fileInput.value = '';
                urlInput.value = '';
                loadImagesList(subId);
                alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­.');
            } else {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø£Ùˆ Ø±ÙØ¹ Ù…Ù„Ù ØµÙˆØ±Ø©.');
            }
        }

        function loadImagesList(subId = null) {
            const listDiv = document.getElementById('imageList');
            listDiv.innerHTML = '';
            
            const selectedSubId = subId || document.getElementById('imageSubCategory').value;

            if (selectedSubId && images[selectedSubId]) {
                images[selectedSubId].forEach(img => {
                    const div = document.createElement('div');
                    div.className = 'thumb-inline';
                    div.innerHTML = `
                        <img src="${img.url}" alt="ØµÙˆØ±Ø© Ù…Ù†ØªØ¬" />
                        <button class="delete-btn" style="padding: 5px 8px; font-size: 14px;" onclick="deleteImage('${selectedSubId}', '${img.id}')">Ø­Ø°Ù</button>
                    `;
                    listDiv.appendChild(div);
                });
                if (images[selectedSubId].length === 0) {
                    listDiv.innerHTML = '<p class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù….</p>';
                }
            } else {
                listDiv.innerHTML = '<p class="small">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±.</p>';
            }
        }

        function deleteImage(subId, imgId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©ØŸ')) {
                images[subId] = images[subId].filter(img => img.id !== imgId);
                saveImages();
                loadImagesList(subId);
            }
        }

        /* ======= Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Clients) (Ù„Ù… ØªØªØºÙŠØ±) ======= */
        function loadClients() {
            const list = document.getElementById('clientList');
            list.innerHTML = '';
            
            clients.forEach(client => {
                const totalOrders = orders.filter(o => o.clientId === client.phone).length;
                const li = document.createElement('li');
                li.style.borderBottom = '1px dashed #333';
                li.style.paddingBottom = '10px';
                li.style.marginTop = '10px';
                li.innerHTML = `
                    <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${client.name}</p>
                    <p><strong>Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†:</strong> ${client.phone}</p>
                    <p><strong>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:</strong> ${client.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</p>
                    <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</strong> ${totalOrders}</p>
                    <button style="font-size: 14px; padding: 5px 8px; margin-top: 5px;" onclick="alert('Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ø¹Ù…ÙŠÙ„ Ø±Ù‚Ù… ${client.phone} (ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ·ÙˆÙŠØ± ÙˆØ§Ø¬Ù‡Ø© Ø®Ø§ØµØ©).')">Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
                `;
                list.appendChild(li);
            });
        }
        
        /* ======= Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Orders) - Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø¹Ø¯Ù„ ======= */
        function getStatusText(status) {
            switch (status) {
                case 'new': return 'Ø¬Ø¯ÙŠØ¯ (ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©)';
                case 'pending': return 'Ù…Ø¹Ù„Ù‘ÙÙ‚';
                case 'in_progress': return 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°';
                case 'completed': return 'Ù…ÙƒØªÙ…Ù„';
                case 'cancelled': return 'Ù…Ù„ØºÙŠ';
                default: return status;
            }
        }

        function createOrder(imageUrl) {
            if (!currentUser) { alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨.'); showSection('login'); return; }
            
            const newOrder = {
                id: generateId('ord'),
                clientId: currentUser.phone,
                clientName: currentUser.name,
                imageUrl: imageUrl,
                status: 'new', // ØªØ¨Ø¯Ø£ ÙƒÙ€ "Ø¬Ø¯ÙŠØ¯"
                date: new Date().toLocaleDateString('ar-EG')
            };
            orders.push(newOrder);
            saveOrders();
            alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.');
        }

        // **ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„: Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© (Ù…Ø¹Ø¯Ù„Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± ID Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨)**
        function switchOrdersTab(status) {
            if (!currentUser) return; // ØªØ­Ù‚Ù‚ Ø§Ø­ØªÙŠØ§Ø·ÙŠ
            
            document.querySelectorAll('#tabPending, #tabCompleted, #tabCancelled').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`tab${status.charAt(0).toUpperCase() + status.slice(1)}`).classList.add('active');
            
            const content = document.getElementById('ordersContent');
            content.innerHTML = '';
            
            // Ø¥Ø¸Ù‡Ø§Ø± ID Ø§Ù„Ø¹Ù…ÙŠÙ„
            document.getElementById('clientOrderIDDisplay').textContent = `Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (ID): ${currentUser.phone}`;

            let filterStatuses = [];
            if (status === 'pending') {
                 // Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ±Ù‰ Ø§Ù„Ù€ 'new' ÙˆØ§Ù„Ù€ 'pending' ÙˆØ§Ù„Ù€ 'in_progress' ÙƒÙ€ 'Ù…Ø¹Ù„Ù‘ÙÙ‚' Ø£Ùˆ 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°'
                 filterStatuses = ['new', 'pending', 'in_progress'];
            } else {
                 filterStatuses = [status];
            }
            
            const clientOrders = orders.filter(o => 
                o.clientId === currentUser.phone && filterStatuses.includes(o.status)
            );

            if (clientOrders.length === 0) {
                content.innerHTML = `<p class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>`;
                return;
            }

            clientOrders.forEach(order => {
                const item = document.createElement('div');
                item.className = 'order-item';
                item.innerHTML = `
                    <p><strong>ÙƒÙˆØ¯ Ø§Ù„Ø·Ù„Ø¨:</strong> <span style="color:#00bcd4;">${order.id}</span></p>
                    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</strong> ${order.date}</p>
                    <p><strong>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬:</strong> <img src="${order.imageUrl}" style="max-width: 100px; display: block; margin: 5px 0 10px auto; border-radius: 5px;"/></p>
                    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${getStatusText(order.status)}</p>
                `;
                content.appendChild(item);
            });
        }
        
        // **ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø£Ø¯Ù…Ù†: Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (New) (Ù„Ù… ØªØªØºÙŠØ±)**
        function renderAdminOrdersList() {
            const listDiv = document.getElementById('adminOrdersList');
            listDiv.innerHTML = '';
            
            const newOrders = orders.filter(o => o.status === 'new');
            
            if (newOrders.length === 0) {
                listDiv.innerHTML = '<p class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.</p>';
                return;
            }

            newOrders.forEach(order => {
                const client = clients.find(c => c.phone === order.clientId) || { name: 'Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ' };
                const item = document.createElement('div');
                item.className = 'order-item';
                item.innerHTML = `
                    <p><strong>ÙƒÙˆØ¯:</strong> ${order.id}</p>
                    <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${client.name} (${order.clientId})</p>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${order.date}</p>
                    <p><strong>Ø§Ù„Ù…Ù†ØªØ¬:</strong> <img src="${order.imageUrl}" style="max-width: 80px; display: block; margin: 5px 0 10px auto; border-radius: 5px;"/></p>
                    <div class="order-actions" style="margin-top: 10px;">
                        <button onclick="updateOrderStatus('${order.id}', 'pending')">ØªØ¹Ù„ÙŠÙ‚/Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°</button> 
                        <button onclick="updateOrderStatus('${order.id}', 'completed')">Ø¥ÙƒÙ…Ø§Ù„</button>
                        <button class="delete-btn" onclick="updateOrderStatus('${order.id}', 'cancelled')">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                `;
                listDiv.appendChild(item);
            });
        }
        
        // **ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø£Ø¯Ù…Ù†: Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‘ÙÙ‚Ø© (Pending / In_Progress) (Ù„Ù… ØªØªØºÙŠØ±)**
        function renderAdminPendingOrdersList() {
            const listDiv = document.getElementById('adminPendingOrdersList');
            listDiv.innerHTML = '';
            
            const pendingOrders = orders.filter(o => o.status === 'pending' || o.status === 'in_progress');
            
            if (pendingOrders.length === 0) {
                listDiv.innerHTML = '<p class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‘ÙÙ‚Ø© Ø£Ùˆ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°.</p>';
                return;
            }

            pendingOrders.forEach(order => {
                const client = clients.find(c => c.phone === order.clientId) || { name: 'Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ' };
                const item = document.createElement('div');
                item.className = 'order-item';
                item.innerHTML = `
                    <p><strong>ÙƒÙˆØ¯:</strong> ${order.id}</p>
                    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${getStatusText(order.status)}</p>
                    <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${client.name} (${order.clientId})</p>
                    <p><strong>Ø§Ù„Ù…Ù†ØªØ¬:</strong> <img src="${order.imageUrl}" style="max-width: 80px; display: block; margin: 5px 0 10px auto; border-radius: 5px;"/></p>
                    <div class="order-actions" style="margin-top: 10px;">
                        ${order.status === 'pending' ? `<button onclick="updateOrderStatus('${order.id}', 'in_progress')">Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°</button>` : `<button onclick="updateOrderStatus('${order.id}', 'pending')">ØªØ¹Ù„ÙŠÙ‚ Ù…Ø¤Ù‚Øª</button>`}
                        <button onclick="updateOrderStatus('${order.id}', 'completed')">Ø¥ÙƒÙ…Ø§Ù„</button>
                        <button class="delete-btn" onclick="updateOrderStatus('${order.id}', 'cancelled')">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                `;
                listDiv.appendChild(item);
            });
        }
        
        // **ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø£Ø¯Ù…Ù†: Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© (Completed) (Ù„Ù… ØªØªØºÙŠØ±)**
        function renderAdminCompletedOrdersList() {
            const listDiv = document.getElementById('adminCompletedOrdersSection');
            listDiv.innerHTML = '';
            
            const completedOrders = orders.filter(o => o.status === 'completed');
            
            if (completedOrders.length === 0) {
                listDiv.innerHTML = '<p class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©.</p>';
                return;
            }

            completedOrders.forEach(order => {
                const client = clients.find(c => c.phone === order.clientId) || { name: 'Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ' };
                const item = document.createElement('div');
                item.className = 'order-item';
                item.innerHTML = `
                    <p><strong>ÙƒÙˆØ¯:</strong> ${order.id}</p>
                    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${getStatusText(order.status)}</p>
                    <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${client.name} (${order.clientId})</p>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${order.date}</p>
                    <p><strong>Ø§Ù„Ù…Ù†ØªØ¬:</strong> <img src="${order.imageUrl}" style="max-width: 80px; display: block; margin: 5px 0 10px auto; border-radius: 5px;"/></p>
                `;
                listDiv.appendChild(item);
            });
        }

        // **ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© - Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ (Ù„Ù… ØªØªØºÙŠØ±)**
        function updateOrderStatus(orderId, newStatus) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                if (newStatus === 'cancelled' && !confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø±Ù‚Ù… ${orderId}ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
                    return;
                }
                
                order.status = newStatus;
                saveOrders();
                
                alert(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ${orderId} Ø¥Ù„Ù‰ ${getStatusText(newStatus)}.`);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù†Ø´Ø· Ù„Ù„Ø£Ø¯Ù…Ù†
                if (currentActiveSection === 'adminOrdersSection') renderAdminOrdersList();
                if (currentActiveSection === 'adminPendingOrdersSection') renderAdminPendingOrdersList();
                if (currentActiveSection === 'adminCompletedOrdersSection') renderAdminCompletedOrdersList();
                // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¯Ø§Ø®Ù„ Ù‚Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‡Ùˆ Ù†ÙØ³Ù‡
                if (currentActiveSection === 'adminClientOrdersSection' && currentClientForOrders && currentClientForOrders.phone === order.clientId) {
                     displayClientOrders(currentClientForOrders);
                }
                // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¬Ù„Ø§Ù‹ Ø§Ù„Ø¯Ø®ÙˆÙ„
                if (currentUser && currentUser.phone === order.clientId && currentActiveSection === 'myOrders') {
                    const activeTab = document.querySelector('#myOrders .tab.active').id.replace('tab', '').toLowerCase();
                    switchOrdersTab(activeTab);
                }
            }
        }

        /* ======= Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (Chats) (Ù„Ù… ØªØªØºÙŠØ±) ======= */
        function startInquiry(imageUrl) {
            if (!currentUser) { alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ø±Ø§Ø³Ù„Ø©.'); showSection('login'); return; }
            
            const message = `Ø£Ø³ØªÙØ³Ø± Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„ØªØ§Ù„ÙŠ: ${imageUrl}`;
            sendMessage(message, 'inquiry', true);
            alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ. Ø³ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ ÙÙŠ Ù‚Ø³Ù… "ØªÙˆØ§ØµÙ„".');
        }

        function renderMessages(contentId, chatId, type) {
            const content = document.getElementById(contentId);
            content.innerHTML = '';
            
            const chatObj = chats[chatId];
            if (!chatObj) return;

            const messages = chatObj.chats[type];

            messages.forEach(msg => {
                const div = document.createElement('div');
                div.className = 'message ' + (msg.sender === 'user' ? 'my-message' : 'their-message');
                div.textContent = msg.text;
                content.appendChild(div);
            });
            content.scrollTop = content.scrollHeight; 
        }

        function switchChatTab(type) {
            document.querySelectorAll('#tabInquiry, #tabComplaint').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`tab${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.add('active');
            activeClientChatType = type;
            if (currentUser) { renderMessages('messagesContent', currentUser.phone, type); }
        }

        function sendMessage(text, type, isUser = true) {
            if (!currentUser) return;
            const msg = {
                text: text || document.getElementById('messageInput').value.trim(),
                sender: isUser ? 'user' : 'admin',
                timestamp: Date.now()
            };

            if (!msg.text) return;
            
            const chatId = currentUser.phone;
            if (!chats[chatId]) {
                 chats[chatId] = { clientName: currentUser.name, clientId: chatId, chats: { inquiry: [], complaint: [] }, newMessages: { inquiry: false, complaint: false } };
            }

            chats[chatId].chats[type].push(msg);
            chats[chatId].newMessages[type] = isUser; 
            saveChats();
            
            document.getElementById('messageInput').value = '';
            renderMessages('messagesContent', chatId, type);
        }

        document.getElementById('sendMessageBtn').addEventListener('click', () => sendMessage(null, activeClientChatType, true));

        // Admin Chat Functions (Ù„Ù… ØªØªØºÙŠØ±)
        function renderAdminChatList() {
            const listDiv = document.getElementById('chatUsersList');
            listDiv.innerHTML = '';
            
            const chatEntries = Object.values(chats).sort((a, b) => {
                const aNew = a.newMessages.inquiry || a.newMessages.complaint;
                const bNew = b.newMessages.inquiry || b.newMessages.complaint;
                if (aNew && !bNew) return -1;
                if (!aNew && bNew) return 1;
                return 0;
            });
            
            if (chatEntries.length === 0) {
                 listDiv.innerHTML = '<p class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø¯Ø£ÙˆØ§ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø¹Ø¯.</p>';
                 return;
            }

            chatEntries.forEach(chat => {
                const hasNew = chat.newMessages.inquiry || chat.newMessages.complaint;
                const div = document.createElement('div');
                div.className = 'order-item';
                div.style.cursor = 'pointer';
                div.style.borderColor = hasNew ? '#ff8c00' : 'rgba(255, 255, 255, 0.2)';
                div.onclick = () => openAdminChat(chat.clientId);
                div.innerHTML = `
                    <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${chat.clientName} (${chat.clientId})</p>
                    <p class="small" style="color:${chat.newMessages.inquiry ? '#00bcd4' : '#888'};">Ø§Ø³ØªÙØ³Ø§Ø±: ${chat.newMessages.inquiry ? 'Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø¯ÙŠØ¯Ø©' : 'Ù„Ø§ Ø¬Ø¯ÙŠØ¯'}</p>
                    <p class="small" style="color:${chat.newMessages.complaint ? '#ff5252' : '#888'};">Ø´ÙƒÙˆÙ‰: ${chat.newMessages.complaint ? 'Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø¯ÙŠØ¯Ø©' : 'Ù„Ø§ Ø¬Ø¯ÙŠØ¯'}</p>
                `;
                listDiv.appendChild(div);
            });
        }
        
        function openAdminChat(clientId) {
            activeChatId = clientId;
            const chatObj = chats[clientId];
            const client = clients.find(c => c.phone === clientId);

            document.getElementById('adminChatHeader').innerHTML = `
                ${chatObj.clientName}
                <button id="adminClientDataBtn" style="font-size:14px; padding:6px 10px;" onclick="alert('Ø§Ù„Ø§Ø³Ù…: ${client.name}\\nØ§Ù„ØªÙ„ÙŠÙÙˆÙ†: ${client.phone}\\nØ§Ù„Ø¥ÙŠÙ…ÙŠÙ„: ${client.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}')">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
            `;
            
            activeAdminChatType = (chatObj.newMessages.inquiry || chatObj.chats.inquiry.length > 0) ? 'inquiry' : 'complaint';
            
            document.getElementById('adminTabInquiry').classList.remove('active');
            document.getElementById('adminTabComplaint').classList.remove('active');
            document.getElementById(`adminTab${activeAdminChatType.charAt(0).toUpperCase() + activeAdminChatType.slice(1)}`).classList.add('active');

            renderMessages('adminMessagesContent', clientId, activeAdminChatType);
            showAdminSection('adminChatWindow');
            
            if (chatObj.newMessages[activeAdminChatType]) {
                chatObj.newMessages[activeAdminChatType] = false;
                saveChats();
                renderAdminChatList();
            }
        }
        
        function switchAdminChatTab(type) {
            document.querySelectorAll('#adminTabInquiry, #adminTabComplaint').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`adminTab${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.add('active');
            activeAdminChatType = type;
            renderMessages('adminMessagesContent', activeChatId, type);
            
            if (chats[activeChatId].newMessages[type]) {
                chats[activeChatId].newMessages[type] = false;
                saveChats();
                renderAdminChatList();
            }
        }

        function adminSendMessage() {
            if (!loggedInAdmin || !activeChatId) return;
            const text = document.getElementById('adminMessageInput').value.trim();
            if (!text) return;
            
            const msg = { text: text, sender: 'admin', timestamp: Date.now() };

            chats[activeChatId].chats[activeAdminChatType].push(msg);
            chats[activeChatId].newMessages[activeAdminChatType] = false; 
            saveChats();
            
            document.getElementById('adminMessageInput').value = '';
            renderMessages('adminMessagesContent', activeChatId, activeAdminChatType);
            renderAdminChatList();
        }

        document.getElementById('adminSendMessageBtn').addEventListener('click', adminSendMessage);

        /* ======= ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ§Øª (Ù„Ù… ØªØªØºÙŠØ±) ======= */

        function loadBackgroundTargetOptions() {
            loadCurrentBackground();
        }

        function loadCurrentBackground() {
            const targetId = document.getElementById('backgroundTarget').value;
            const bgImageFile = document.getElementById('bgImageFile');
            const bgImageUrl = document.getElementById('bgImageUrl');
            const bgVideoUrl = document.getElementById('bgVideoUrl');
            const imageControls = document.getElementById('imageControls');
            const videoControls = document.getElementById('videoControls');
            
            bgImageFile.value = '';
            bgImageUrl.value = '';
            bgVideoUrl.value = '';
            
            let targetBgData;
            
            if (targetId === 'global_image') {
                targetBgData = backgrounds.global_image;
                imageControls.style.display = 'block';
                videoControls.style.display = 'none';
            } else if (targetId === 'global_video') {
                targetBgData = backgrounds.global_video;
                imageControls.style.display = 'none';
                videoControls.style.display = 'block';
            } else {
                targetBgData = backgrounds[targetId];
                imageControls.style.display = 'block';
                videoControls.style.display = 'block';
            }

            if (targetBgData) {
                if (targetBgData.type === 'image') {
                    bgImageUrl.value = targetBgData.url || '';
                } else if (targetBgData.type === 'video') {
                    bgVideoUrl.value = targetBgData.url || '';
                }
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        async function setSpecificBackground(type) {
            const targetId = document.getElementById('backgroundTarget').value;
            let url = null;
            
            if (type === 'image') {
                const fileInput = document.getElementById('bgImageFile');
                const urlInput = document.getElementById('bgImageUrl');
                
                if (fileInput.files.length > 0) {
                    try {
                        url = await fileToBase64(fileInput.files[0]);
                    } catch (error) {
                        alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø©.');
                        return;
                    }
                } else if (urlInput.value.trim()) {
                    url = urlInput.value.trim();
                } else {
                    url = null;
                }
            } else if (type === 'video') {
                const urlInput = document.getElementById('bgVideoUrl');
                if (urlInput.value.trim()) {
                    url = urlInput.value.trim();
                } else {
                    url = null;
                }
            }

            processBackgroundSet(targetId, type, url);
            
            if (url) alert(`ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© (${type === 'image' ? 'ØµÙˆØ±Ø©' : 'ÙÙŠØ¯ÙŠÙˆ'}) Ø¨Ù†Ø¬Ø§Ø­.`);
            else alert(`ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù….`);
            
            if (currentActiveSection === targetId || targetId.startsWith('global_')) {
                 applyBackground(currentActiveSection);
            }
        }
        
        function processBackgroundSet(targetId, type, url) {
            const data = url ? { type: type, url: url } : null;

            if (targetId === 'global_image') {
                backgrounds.global_image = data;
                if (data && type === 'image' && backgrounds.global_video) { backgrounds.global_video = null; }
            } else if (targetId === 'global_video') {
                backgrounds.global_video = data;
                if (data && type === 'video' && backgrounds.global_image) { backgrounds.global_image = null; }
            } else {
                backgrounds[targetId] = data;
            }
            
            saveBackgrounds();
            loadCurrentBackground(); 
        }

        function applyBackground(sectionId) {
            const body = document.body;
            const video = document.getElementById('backgroundVideo');
            
            let bgData = backgrounds[sectionId];
            
            if (!bgData) {
                if (backgrounds.global_video) {
                     bgData = backgrounds.global_video;
                } else if (backgrounds.global_image) {
                    bgData = backgrounds.global_image;
                }
            }

            // Reset
            body.style.backgroundImage = 'none';
            video.style.display = 'none';
            video.pause();
            video.src = ''; 
            video.load();

            if (bgData && bgData.url) {
                if (bgData.type === 'video') {
                    video.src = bgData.url;
                    video.style.display = 'block';
                    video.load();
                    video.play().catch(e => {
                        console.log('Video autoplay blocked, trying to set image if available.', e);
                        if (backgrounds.global_image && backgrounds.global_image.url) {
                            body.style.backgroundImage = `url('${backgrounds.global_image.url}')`;
                        }
                    });
                } else if (bgData.type === 'image') {
                    body.style.backgroundImage = `url('${bgData.url}')`;
                }
            } else {
                body.style.backgroundImage = 'none';
            }
        }

        /* ======= ÙˆØ¸Ø§Ø¦Ù Ù‚Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù„Ù… ØªØªØºÙŠØ±) ======= */

        function initAdminClientOrders() {
            // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø¨Ø­Ø«
            document.getElementById('adminClientsListArea').style.display = 'block';
            // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
            document.getElementById('clientOrdersDetailArea').style.display = 'none';
            // Ù…Ø³Ø­ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¨Ø­Ø«
            document.getElementById('clientSearchInput').value = '';
            document.getElementById('orderSearchInput').value = '';
            // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
            filterClients();
        }

        function filterClients() {
            const searchTerm = document.getElementById('clientSearchInput').value.toLowerCase().trim();
            const listDiv = document.getElementById('filteredClientsList');
            listDiv.innerHTML = '';
            
            const filtered = clients.filter(client => 
                !searchTerm ||
                client.name.toLowerCase().includes(searchTerm) ||
                client.phone.includes(searchTerm) 
            );

            if (filtered.length === 0) {
                listDiv.innerHTML = '<p class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø·Ø§Ø¨Ù‚ÙˆÙ† Ù„Ù„Ø¨Ø­Ø«.</p>';
                return;
            }

            filtered.forEach(client => {
                const totalOrders = orders.filter(o => o.clientId === client.phone).length;
                const div = document.createElement('div');
                div.className = 'client-item';
                div.onclick = () => displayClientOrders(client);
                div.innerHTML = `
                    <p style="margin: 0;"><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${client.name}</p>
                    <p style="margin: 5px 0 0 0; font-size: 16px;"><strong>Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†/ID:</strong> ${client.phone}</p>
                    <p style="margin: 5px 0 0 0; font-size: 16px; color: #fff;"><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</strong> ${totalOrders}</p>
                `;
                listDiv.appendChild(div);
            });
        }

        function displayClientOrders(client) {
            currentClientForOrders = client;
            document.getElementById('clientOrdersHeader').textContent = `Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„: ${client.name} (ID: ${client.phone})`;
            
            // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            document.getElementById('adminClientsListArea').style.display = 'none';
            document.getElementById('clientOrdersDetailArea').style.display = 'block';
            document.getElementById('orderSearchInput').value = '';
            
            filterClientOrders();
        }

        function filterClientOrders() {
            if (!currentClientForOrders) return;

            const searchTerm = document.getElementById('orderSearchInput').value.toLowerCase().trim();
            const ordersListDiv = document.getElementById('currentClientOrdersList');
            ordersListDiv.innerHTML = '';

            const clientOrders = orders
                .filter(o => o.clientId === currentClientForOrders.phone)
                .sort((a, b) => b.date.localeCompare(a.date)); // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®

            const filteredOrders = clientOrders.filter(order => 
                !searchTerm ||
                order.id.toLowerCase().includes(searchTerm)
            );

            if (filteredOrders.length === 0) {
                ordersListDiv.innerHTML = '<p class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«.</p>';
                return;
            }

            filteredOrders.forEach((order, index) => {
                const item = document.createElement('div');
                item.className = 'client-order-item';
                item.innerHTML = `
                    <p style="font-weight: bold; color: #00bcd4;">Ø§Ù„ØªØ±Ù‚ÙŠÙ…: ${index + 1}</p>
                    <p><strong>ÙƒÙˆØ¯ Ø§Ù„Ø·Ù„Ø¨:</strong> ${order.id}</p>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${order.date}</p>
                    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span style="font-weight: bold; color: ${order.status === 'completed' ? '#4CAF50' : order.status === 'cancelled' ? '#ff5252' : '#ff8c00'};">${getStatusText(order.status)}</span></p>
                    <p><strong>Ø§Ù„Ù…Ù†ØªØ¬:</strong> <img src="${order.imageUrl}" style="max-width: 80px; display: block; margin: 5px auto 10px 0; border-radius: 5px;"/></p>
                    <div class="order-actions">
                        <button style="font-size: 14px; padding: 5px 8px;" onclick="updateOrderStatus('${order.id}', 'pending')">Ù…Ø¹Ù„Ù‘ÙÙ‚</button> 
                        <button style="font-size: 14px; padding: 5px 8px;" onclick="updateOrderStatus('${order.id}', 'in_progress')">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</button>
                        <button style="font-size: 14px; padding: 5px 8px;" onclick="updateOrderStatus('${order.id}', 'completed')">Ù…ÙƒØªÙ…Ù„</button>
                        <button class="delete-btn" style="font-size: 14px; padding: 5px 8px;" onclick="updateOrderStatus('${order.id}', 'cancelled')">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                `;
                ordersListDiv.appendChild(item);
            });
        }
    </script>
</body>
</html>